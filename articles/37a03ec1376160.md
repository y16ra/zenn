---
title: "OpenAIã® Assistants APIã§Vector Storeã‚’ä½¿ã£ãŸå®Ÿè£…ã‚’è©¦ã—ã¦ã¿ãŸ"
emoji: "ğŸŒŠ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["ai", "openai", "openaiapi"]
published: true
---

## ã¯ã˜ã‚ã«

OpenAI ã® Assistants API ã«ã¤ã„ã¦èª¿æŸ»ã—ãŸã®ã§ã€ãã®å†…å®¹ã‚’å…±æœ‰ã—ã¾ã™ã€‚
Assistants API ã¯ç¾åœ¨ãƒ™ãƒ¼ã‚¿ç‰ˆã§æä¾›ã•ã‚Œã¦ã„ã‚‹APIã§ã™ã€‚
ãƒ™ãƒ¼ã‚¿ç‰ˆãªã®ã§è¨˜äº‹ã§æ›¸ã„ã¦ã„ã‚‹å†…å®¹ãŒå¤‰æ›´ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã®ã§ã”äº†æ‰¿ãã ã•ã„ã€‚

https://platform.openai.com/docs/assistants/overview

## Assistants API ã®æ¦‚è¦

Assistantsã«ã¯ã€ä»¥ä¸‹ã®é …ç›®ã‚’è¨­å®šã§ãã¾ã™ã€‚
- System instructions
- Model
- Tools

åˆ©ç”¨ã§ãã‚‹Toolsã«ã¯ä»¥ä¸‹ã®ã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚
- Code Interpreter
- File Search
- Function Calling

ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã®UIã‚’è¦‹ã‚‹ã¨ã‚ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚
![openai-console-assistants](/images/articles/37a03ec1376160/openai-console-assistants.png =400x)
*OpenAIã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢*

## Assistants API ã®ä½¿ã„æ–¹

![](https://cdn.openai.com/API/docs/images/diagram-assistant.webp)

1. Assistant: åå‰ã€ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã€ãƒ„ãƒ¼ãƒ«ã‚’æŒ‡å®šã—ã¦ä½œæˆã—ã¾ã™ã€‚
1. Thread: ä¼šè©±ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ç®¡ç†ã—ã¾ã™ã€‚
1. Message: ãƒ¦ãƒ¼ã‚¶ã¨ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ã€‚Threadã«ãƒªã‚¹ãƒˆã§ä¿ç®¡ã•ã‚Œã¾ã™ã€‚
1. Run: Threadä¸Šã§Assistantã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

ä»Šå›ã¯File Searchãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦Vector Storeã«ç™»éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦å›ç­”ã™ã‚‹Assistantã‚’ä½œæˆã—ã¾ã™ã€‚
ä»Šå›ã¯Vector Storeã¯ç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰äº‹å‰ã«ç™»éŒ²ã—ã¾ã—ãŸã€‚
ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚Œã°Vector Storeã«ãƒ‡ãƒ¼ã‚¿ãŒç™»éŒ²ã•ã‚Œã¾ã™ã€‚

![](/images/articles/37a03ec1376160/vector-store.png)

### Assistant ã®ä½œæˆ
Assistantã¯ç”¨é€”ã”ã¨ã«ä½œæˆã—ã¾ã™ã€‚
APIã§ä½œæˆã§ãã¾ã™ãŒç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ä½œæˆã—ã¦IDã‚’å–å¾—ã—ã¦ä½¿ã†ã®ã§ã‚‚è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚

```python
assistant = client.beta.assistants.create(
    name="AI File Search Assistant",
    instructions="ã‚ãªãŸã¯AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚æŒ‡ç¤ºãŒãªã‘ã‚Œã°æ—¥æœ¬èªã§å›ç­”ã—ã¾ã™ã€‚",
    model="gpt-4o",
    tools=[{"type": "file_search"}],
    tool_resources={"file_search": {"vector_store_ids": [VECTOR_STORE_ID]}},
)
```

### Thread ã®ä½œæˆ

ç©ºã®Threadã‚’ä½œæˆã—ã¾ã™ã€‚

```python
thread = client.beta.threads.create()
```

Threadã«ã¯å›ç­”ã®Messageã‚‚è‡ªå‹•ã§ç™»éŒ²ã•ã‚Œã¾ã™ã®ã§ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®åº¦ã«å…¨ã¦ã®ä¼šè©±å±¥æ­´ã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æ¸¡ã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
`thread.id` ã‚’ä½¿ã£ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ä¾¿åˆ©ã§ã™ã€‚

### Message ã®ä½œæˆ

å…ˆã»ã©ä½œæˆã—ãŸThreadã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```python
prompt = "XXXXã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„ã€‚"
thread_message = client.beta.threads.messages.create(
    thread.id,
    role="user",
    content=prompt,
)
```

### Assistant ã®å®Ÿè¡Œ

ä½œæˆã—ãŸThreadä¸Šã§Assistantã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```python
run = client.beta.threads.runs.create(
    thread_id=thread.id,
    assistant_id=assistant_id,
)
while True:
    run = client.beta.threads.runs.retrieve(
        thread_id=thread.id,
        run_id=run.id
    )
    if run.status == "completed":
        break
    time.sleep(1)
```

### çµæœã®å–å¾—

status ãŒ completed ã«ãªã£ãŸã‚‰çµæœã‚’å–å¾—ã—ã¾ã™ã€‚

```python
thread_messages = client.beta.threads.messages.list(thread_id)
if thread_messages[0].content[0].type == "text":
  print(thread_messages[0].content[0].text.value)
```

## ã¾ã¨ã‚

OpenAIã®Assistants APIã‚’ä½¿ã£ã¦æ‰‹è»½ã«RAGã®ã‚ˆã†ãªä¸€èˆ¬ã«å…¬é–‹ã•ã‚Œã¦ã„ãªã„æƒ…å ±ã‚„æœ€æ–°ã®æƒ…å ±ã‚’ä½¿ã£ãŸè³ªå•å¿œç­”ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
Amazon Bedrock ã®ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã§ã‚‚åŒæ§˜ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒVector Storeã®ç®¡ç†ãŒOpenAIã®æ–¹ãŒç°¡å˜ã§ã—ãŸã€‚
è‡ªåˆ†ã®ç”¨é€”ã«ã‚ã£ãŸãƒ‡ãƒ¼ã‚¿ã‚’Vector Storeã«ç™»éŒ²ã—ã¦ä½¿ã„ã“ãªã›ã‚‹ã¨è‰²ã€…ã¨æ—ã‚Šãã†ã§ã™ã€‚

ä»Šå›ã®å‹•ä½œç¢ºèªã¯Pythonã§è¡Œã„ã¾ã—ãŸã€‚æ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚Šã¾ã™ã®ã§å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
https://github.com/y16ra/openai-assistants-sample

## ãŠã¾ã‘

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ›¸ãæ–¹ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆãŒå‚è€ƒã«ãªã‚Šã¾ã™ã€‚
https://platform.openai.com/docs/guides/prompt-engineering
https://www.promptingguide.ai/jp
